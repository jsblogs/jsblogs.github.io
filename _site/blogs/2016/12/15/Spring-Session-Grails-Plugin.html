<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=0970a0d2116d6377d26dd99d6ab42d9c9d8abfe4">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Spring-Session Grails Plugin (Part 1) | JSBlogs</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Spring-Session Grails Plugin (Part 1)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Part 1 of “Spring Session Grails Plugin” series. This blog series will cover Introduction, Installation and Redis Datastore." />
<meta property="og:description" content="Part 1 of “Spring Session Grails Plugin” series. This blog series will cover Introduction, Installation and Redis Datastore." />
<link rel="canonical" href="http://0.0.0.0:4000/blogs/2016/12/15/Spring-Session-Grails-Plugin" />
<meta property="og:url" content="http://0.0.0.0:4000/blogs/2016/12/15/Spring-Session-Grails-Plugin" />
<meta property="og:site_name" content="JSBlogs" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-12-15T09:30:00+05:30" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/blogs/2016/12/15/Spring-Session-Grails-Plugin"},"url":"http://0.0.0.0:4000/blogs/2016/12/15/Spring-Session-Grails-Plugin","headline":"Spring-Session Grails Plugin (Part 1)","dateModified":"2016-12-15T09:30:00+05:30","datePublished":"2016-12-15T09:30:00+05:30","description":"Part 1 of “Spring Session Grails Plugin” series. This blog series will cover Introduction, Installation and Redis Datastore.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>

<header>
    <div class="container">
        <small class="date">15 December 2016</small>
        <div style="float: right">
            <a href="/" >
                <i class="fa fa-home fa-3x" aria-hidden="true"></i>
            </a>
        </div>
        <h1>Spring-Session Grails Plugin (Part 1)</h1>

        <p class="view"></p>
        
        <small class="tags"><tag><i class="fa fa-tag"></i>grails</tag><tag><i class='fa fa-tag'></i>java</tag><tag><i class='fa fa-tag'></i>spring-session</tag></small>
        
    </div>
</header>

<div class="container">
    <section id="main_content">
        <p><a href="https://github.com/jeetmp3/spring-session" target="_blank"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" /></a></p>

<p>This tutorial will guide you how to configure and use <a href="https://grails.org/plugin/spring-session" target="_blank"><strong>spring-session grails plugin</strong></a>
    in grails 2x application. This blog will also cover various datastore currently supported by this plugin along with
    serializers to serialize/deserialize your session to/from the store.</p>

<p>This blog is divided into 3 sections</p>

<ol>
  <li>Introduction</li>
  <li>Installation</li>
  <li>Redis Datastore</li>
</ol>

<h4 id="1-introduction">1. Introduction</h4>
<p>This <strong>grails plugin</strong> helps you to easily setup <a href="http://projects.spring.io/spring-session/" target="_blank"><strong>Spring Session</strong></a> project in your grails application.</p>

<h5 id="what-is-spring-session">What is Spring Session?</h5>
<p><strong>Spring Session</strong> is project of Spring community which provides an API and implementations for managing a user’s session information. It allows you to store user’s session in datastore such as <strong>Redis</strong>, <strong>MongoDB</strong>, <strong>JDBC</strong>, <strong>Hazelcast</strong>, <strong>Gemfire</strong> etc. You can easily change from one datastore to another.</p>

<p>How it is better than traditional way of storing user’s session? Well in Spring session you don’t need to add any kind of jar inside the Servlet Container (tomcat, jetty etc), which means, no container specific dependency. Session management related API (jar) will be inside your application itself. So one container can contain more than one applications which might be using different types of datastore to store user’s session. Which also helps in migrating from one container to another or switch to another vendor (i.e. Tomcat to Jetty).</p>

<p>Other features offered by spring-session:</p>

<ul>
  <li><strong>Clustered Sessions</strong> - It trivial to support clustered sessions without being tied to an application container specific solution.</li>
  <li><strong>Multiple Browser Sessions</strong> - Spring Session supports managing multiple users’ sessions in a single browser instance (i.e. multiple authenticated accounts similar to Google).</li>
  <li><strong>RESTful APIs</strong> - Spring Session allows providing session ids in headers to work with RESTful APIs.</li>
  <li><strong>WebSocket Support</strong> - provides the ability to keep the HttpSession alive when receiving WebSocket messages.</li>
</ul>

<p>By using this plugin you can achieve above features in your grails application.</p>

<p class="notice"><strong>Note:</strong> Spring Session project supports various datastore, which are not configured in this plugin yet. Those datastores are under development. If you wish to contribute in adding datastore support just <a href="https://github.com/jeetmp3/spring-session" target="_blank">fork me on GitHub</a>.</p>

<h4 id="2-installation">2. Installation</h4>
<p>Plugin configuration is very easy. If you’re using grails 2x then add following code in your <code class="language-plaintext highlighter-rouge">BuildConfig.groovy</code> inside the <code class="language-plaintext highlighter-rouge">plugins</code> block</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plugins</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">compile</span> <span class="s2">"org.grails.plugins:spring-session:2.0.0-RC1"</span>
<span class="o">}</span>
</code></pre></div></div>

<p class="notice"><strong>Note:</strong> <em>By Default plugin will use Redis as it’s default datastore. Currently it supports Redis, Mongo and JDBC store to persist session.</em></p>

<p>Currently, this plugin supports 3 datastore.</p>

<ol>
  <li>Redis</li>
  <li>Mongo</li>
  <li>JDBC</li>
</ol>

<p>This blog will cover <strong>Redis</strong> datastore. Other datastores will be covered in next blog.</p>

<h5 id="1-redis">1. Redis</h5>
<p>Initially spring-session project supported only redis datastore. So the Redis is the default datasotre for this plugin.
 To change datastore you need to set below property in your <code class="language-plaintext highlighter-rouge">Config.groovy</code> file.</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">springsession</span><span class="o">.</span><span class="na">sessionStore</span><span class="o">=</span><span class="n">SessionStore</span><span class="o">.</span><span class="na">REDIS</span>
</code></pre></div></div>

<p>Make sure redis server is running on your system. To verify plugin is working, just create a dummy controller in your app.
 Let’s say you’ve created controller called HomeController.</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">demo</span>

<span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>

    <span class="kt">def</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">render</span> <span class="s2">"Hello from home controller"</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now run your grails application and once your app is up then run the below command on terminal.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-c</span> - localhost:8080/g2ss/home/index

<span class="c">#Output</span>
<span class="c">#HttpOnly_localhost    FALSE    /g2ss/    FALSE    0    SESSION    9c3796b4-90d1-4f51-b340-4dc857f6cdd2</span>
</code></pre></div></div>

<p>You will notice the response with session cookie name <code class="language-plaintext highlighter-rouge">SESSION</code> with it’s value <code class="language-plaintext highlighter-rouge">9c3796b4-90d1-4f51-b340-4dc857f6cdd2</code>.
    Cheers!!! Your plugin is configured successfully.</p>

<p>If you wish to override plugin’s default configuration, well that is very easy. You need to change the property related to
 that functionality. e.g. Default cookie name is <code class="language-plaintext highlighter-rouge">SESSION</code>. To change cookie name you need to change following property in your <code class="language-plaintext highlighter-rouge">Config.groovy</code>.</p>
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">springsession</span><span class="o">.</span><span class="na">strategy</span><span class="o">.</span><span class="na">cookie</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="s2">"SPRING_SESSION"</span>
</code></pre></div></div>

<p>Let’s checkout some properties with their impact on plugin.</p>

<h6 id="common-properties">Common properties</h6>
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">springsession</span><span class="o">.</span><span class="na">maxInactiveIntervalInSeconds</span><span class="o">=</span><span class="mi">1800</span> <span class="c1">// Session timeout. default is 1800 seconds</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">sessionStore</span><span class="o">=</span><span class="n">SessionStore</span><span class="o">.</span><span class="na">REDIS</span> <span class="c1">// Select session store. Default is REDIS</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">defaultSerializer</span><span class="o">=</span><span class="n">Serializer</span><span class="o">.</span><span class="na">JDK</span> <span class="c1">// Serialization mechanism, currently supports JDK &amp; JSON Based. Default is JDK</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">strategy</span><span class="o">.</span><span class="na">defaultStrategy</span><span class="o">=</span><span class="n">SessionStrategy</span><span class="o">.</span><span class="na">COOKIE</span> <span class="c1">// session tracking mechanism. Default is COOKIE also suports HEADER</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">strategy</span><span class="o">.</span><span class="na">cookie</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="s2">"SESSION"</span> <span class="c1">// session cookie name. Default is SESSION</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">strategy</span><span class="o">.</span><span class="na">httpHeader</span><span class="o">.</span><span class="na">headerName</span><span class="o">=</span><span class="s2">"x-auth-token"</span> <span class="c1">// session header token name. Default is x-auth-token</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">allow</span><span class="o">.</span><span class="na">persist</span><span class="o">.</span><span class="na">mutable</span><span class="o">=</span><span class="kc">false</span> <span class="c1">// check https://github.com/jeetmp3/spring-session/issues/5 for more detail. Default value is false.</span>
</code></pre></div></div>

<h6 id="redis-store-specific-properties">Redis store specific properties</h6>
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">connectionFactory</span><span class="o">.</span><span class="na">hostName</span><span class="o">=</span><span class="s2">"localhost"</span> <span class="c1">// Redis server hostname. default is localhost</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">connectionFactory</span><span class="o">.</span><span class="na">port</span><span class="o">=</span><span class="mi">6397</span> <span class="c1">// Redis server port. default is 6397</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">connectionFactory</span><span class="o">.</span><span class="na">timeout</span><span class="o">=</span><span class="mi">2000</span> <span class="c1">// Redis server connection timeout. default is 2000</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">connectionFactory</span><span class="o">.</span><span class="na">usePool</span><span class="o">=</span><span class="kc">true</span> <span class="c1">// To use connection pool. default is true</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">connectionFactory</span><span class="o">.</span><span class="na">dbIndex</span><span class="o">=</span><span class="mi">0</span> <span class="c1">// Database number. Default is 0</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">connectionFactory</span><span class="o">.</span><span class="na">password</span><span class="o">=</span><span class="kc">null</span> <span class="c1">// Redis server password. Default is null</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">connectionFactory</span><span class="o">.</span><span class="na">convertPipelineAndTxResults</span><span class="o">=</span><span class="kc">true</span> <span class="c1">// Specifies if pipelined results should be converted to the expected data type. Default is true</span>

<span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">poolConfig</span><span class="o">.</span><span class="na">maxTotal</span><span class="o">=</span><span class="mi">8</span> <span class="c1">// Pool config maximum active connections. Default is 8</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">poolConfig</span><span class="o">.</span><span class="na">maxIdle</span><span class="o">=</span><span class="mi">8</span> <span class="c1">// Pool config maximum idle connections. Default is 8</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">poolConfig</span><span class="o">.</span><span class="na">minIdle</span><span class="o">=</span><span class="mi">0</span> <span class="c1">// Pool config minimum active connections. Default is 0</span>

<span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">sentinel</span><span class="o">.</span><span class="na">master</span><span class="o">=</span><span class="kc">null</span> <span class="c1">// Redis sentinal master node name. Default is null</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">sentinel</span><span class="o">.</span><span class="na">nodes</span><span class="o">=[]</span> <span class="c1">// List of Map sentinal nodes. e.g. [ [host: 'localhost', port: 6379], [host: '', port: 0] ]. Default is blank</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">sentinel</span><span class="o">.</span><span class="na">password</span><span class="o">=</span><span class="kc">null</span> <span class="c1">// Redis sentinal password. Default is null</span>
<span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">sentinel</span><span class="o">.</span><span class="na">timeout</span><span class="o">=</span><span class="mi">2000</span> <span class="c1">// Redis sentinal timeout. Default is 2000</span>
</code></pre></div></div>

<h6 id="json-serialization-specific-properties">JSON serialization specific properties</h6>
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">jackson</span><span class="o">.</span><span class="na">modules</span> <span class="o">=</span> <span class="o">[]</span> <span class="c1">// List of Applicaiton Jackson modules. This plugin use Jackson library to Json serialization.</span>
</code></pre></div></div>

<h5 id="json-serialization">Json Serialization</h5>
<p>By default this plugin use Java serialization. There is a big limitation with this type of serialization, <strong>you need to mark every class @Serializable</strong>.
    Now think of some library classes i.e. any class which comes with library and you don’t have source code for that. What happens when you try
    to serialize that class?</p>

<p><strong><code class="language-plaintext highlighter-rouge">java.io.NotSerializableException</code></strong> Yes you’re right!!!!</p>

<p>In real world applications, you’d like to use libs as much you can because you don’t want to write classes/routines which are already written,
 why not reuse those.</p>

<p>Here comes the Json serialization. In Json serialization you don’t need to put @Serializable on classes. To use Json Serialization in plugin you need to
  change below property</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">springsession</span><span class="o">.</span><span class="na">defaultSerializer</span> <span class="o">=</span> <span class="n">Serializer</span><span class="o">.</span><span class="na">JSON</span>
</code></pre></div></div>

<p>That’s it!!!</p>

<p>Json serialization will work perfectly until your class has default constructor. But if any class doesn’t have default constructor then you’ll need
  to add mixin classes or serializer/deserializer for that class and a Jackson module class. This is the blog which will guide you to <a href="/blogs/2016/09/12/Deserialize-json-with-Java-parameterized-constructor">Deserialize
  json with Java parameterized constructor</a>.</p>

<p>Let’s take an example. I’ve my User class as mentioned below</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">demo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="cm">/**
 * @author Jitendra Singh.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"User{"</span> <span class="o">+</span>
                <span class="s">"name='"</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="sc">'\''</span> <span class="o">+</span>
                <span class="sc">'}'</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>As you can see there is one parameterized constructor. And I want to put this class in session. So what I’ve to do now.</p>

<h6 id="1-create-mixin-for-user">1. Create Mixin for User</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">demo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonCreator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonProperty</span><span class="o">;</span>

<span class="cm">/**
 * @author Jitendra Singh.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserMixin</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@JsonCreator</span>
    <span class="kd">public</span> <span class="nf">UserMixin</span><span class="o">(</span><span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h6 id="2-create-module-class-to-register-mixin">2. Create module class to register mixin</h6>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">demo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.core.Version</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.Module</span><span class="o">;</span>

<span class="cm">/**
 * @author Jitendra Singh.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleModule</span> <span class="kd">extends</span> <span class="nc">Module</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getModuleName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Simple"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Version</span> <span class="nf">version</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Version</span><span class="o">.</span><span class="na">unknownVersion</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setupModule</span><span class="o">(</span><span class="nc">SetupContext</span> <span class="n">setupContext</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">setupContext</span><span class="o">.</span><span class="na">setMixInAnnotations</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">UserMixin</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h6 id="3-register-my-module-class-with-spring-session-plugin">3. Register my module class with spring-session plugin</h6>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">springsession</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">jackson</span><span class="o">.</span><span class="na">modules</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'demo.SimpleModule'</span><span class="o">]</span>
</code></pre></div></div>

<p>That’s it. You’re done.</p>

<p>In <a href="/blogs/2017/02/01/Spring-Session-Grails-Plugin-part-2">next post</a>
    I’ll explain Mongo datastore. Happy coding, Cheers !!!</p>

    </section>
</div>


</body>
</html>