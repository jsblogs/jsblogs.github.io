<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=0970a0d2116d6377d26dd99d6ab42d9c9d8abfe4">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>How to perform tasks when SpringContext starts | JSBlogs</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="How to perform tasks when SpringContext starts" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="SpringFramework provides a way to perform some tasks at the time of application/context started." />
<meta property="og:description" content="SpringFramework provides a way to perform some tasks at the time of application/context started." />
<link rel="canonical" href="http://0.0.0.0:4000/spring/2020/02/25/How-to-perform-tasks-when-SpringContext-starts" />
<meta property="og:url" content="http://0.0.0.0:4000/spring/2020/02/25/How-to-perform-tasks-when-SpringContext-starts" />
<meta property="og:site_name" content="JSBlogs" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-25T09:30:00+05:30" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/spring/2020/02/25/How-to-perform-tasks-when-SpringContext-starts"},"url":"http://0.0.0.0:4000/spring/2020/02/25/How-to-perform-tasks-when-SpringContext-starts","headline":"How to perform tasks when SpringContext starts","dateModified":"2020-02-25T09:30:00+05:30","datePublished":"2020-02-25T09:30:00+05:30","description":"SpringFramework provides a way to perform some tasks at the time of application/context started.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>

<header>
    <div class="container">
        <small class="date">25 February 2020</small>
        <div style="float: right">
            <a href="/" >
                <i class="fa fa-home fa-3x" aria-hidden="true"></i>
            </a>
        </div>
        <h1>How to perform tasks when SpringContext starts</h1>

        <p class="view"></p>
        
        <small class="tags"><tag><i class="fa fa-tag"></i>spring</tag><tag><i class='fa fa-tag'></i>context-started</tag><tag><i class='fa fa-tag'></i>java</tag><tag><i class='fa fa-tag'></i>springboot</tag></small>
        
    </div>
</header>

<div class="container">
    <section id="main_content">
        <ul>
  <li><a href="#intro">Introduction</a></li>
  <li><a href="#tech-used">Technologies used</a></li>
  <li><a href="#app-events">Application Events</a></li>
  <li><a href="#app-runner">ApplicationRunner</a></li>
</ul>

<h2 id="introduction-">Introduction <a name="intro"></a></h2>
<p>Have you ever encountered a situation where you’ve to perform some tasks immediately after the Spring/SpringBoot application starts.  i.e. 
Initialize some data into database, initialize application level constants, make an API call, etc.</p>

<p>There are several ways to achieve it. Here I’m gonna discuss about:</p>
<ol>
  <li>Application events</li>
  <li>ApplicationRunner</li>
</ol>

<h2 id="technologies-used-">Technologies used <a name="tech-used"></a></h2>
<ol>
  <li>Java 11</li>
  <li>Spring Boot 2.2.4</li>
  <li>Gradle 6.0.1</li>
</ol>

<h3 id="application-events-">Application events <a name="app-events"></a></h3>
<p>The Spring framework triggers various events. For our use case we’ll be more interested in <code class="language-plaintext highlighter-rouge">ContextStartedEvent</code> and <code class="language-plaintext highlighter-rouge">ContextRefreshedEvent</code>.
<strong>ContextStartedEvent</strong> event triggered at the time of context gets started.
<strong>ContextRefreshedEvent</strong> event triggered at the time of context gets started or refreshed.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EventHandler</span> <span class="o">{</span>
    <span class="nd">@EventListener</span><span class="o">(</span><span class="nc">ContextStartedEvent</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleContextStartEvent</span><span class="o">(</span><span class="nc">ContextStartedEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Write your code here</span>
    <span class="o">}</span>

    <span class="nd">@EventListener</span><span class="o">(</span><span class="nc">ContextRefreshedEvent</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleContextRefreshEvent</span><span class="o">(</span><span class="nc">ContextRefreshedEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Write your code here</span>
    <span class="o">}</span>
    <span class="c1">// Or you can handle both the events in 1 method  </span>
    
    <span class="nd">@EventListener</span><span class="o">({</span><span class="nc">ContextStartedEvent</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">ContextRefreshedEvent</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleBoth</span><span class="o">(</span><span class="nc">ApplicationContextEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="k">instanceof</span> <span class="nc">ContextStartedEvent</span><span class="o">)</span> <span class="o">{</span>

        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>

        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="applicationrunner-">ApplicationRunner <a name="app-runner"></a></h3>
<p>SpringBoot provides an interface called <code class="language-plaintext highlighter-rouge">ApplicationRunner</code>, any bean implementing this interface should run when that contained in the <code class="language-plaintext highlighter-rouge">SpringApplication</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DBInitializer</span> <span class="kd">implements</span> <span class="nc">ApplicationRunner</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="nf">DBInitializer</span><span class="o">(</span><span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userRepository</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="nc">ApplicationArguments</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">// Initialize user here</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>or the above can be used</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Config</span> <span class="o">{</span>
    
<span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ApplicationRunner</span> <span class="nf">initializeUser</span><span class="o">(</span><span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">args</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="c1">// Initialize user here</span>
        <span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ApplicationRunner provides <code class="language-plaintext highlighter-rouge">ApplicationArguments</code> in the run method which is used to get command line arguments by invoking <code class="language-plaintext highlighter-rouge">getSourceArgs()</code>.
You can also get the parsed arguments using this class. i.e.</p>

<p>Let’s say you’ve passed command line arguments like
<code class="language-plaintext highlighter-rouge">--source /usr/local --print-only --target /tmp/local</code></p>

<p>So the method call to</p>
<ol>
  <li><code class="language-plaintext highlighter-rouge">getOptionNames()</code> in <code class="language-plaintext highlighter-rouge">ApplicationArguments</code> will return set of arguments - [‘source’, ‘print-only’, ‘target’]</li>
  <li><code class="language-plaintext highlighter-rouge">containsOption(String name)</code> checks if argument contains</li>
  <li><code class="language-plaintext highlighter-rouge">getOptionValues(name)</code> returns list of option values. <code class="language-plaintext highlighter-rouge">getOptionValues('source')</code> will return list - [‘/usr/local’]</li>
</ol>


    </section>
</div>


</body>
</html>